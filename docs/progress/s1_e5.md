# Sprint 1 - Étape 5 (S1E5)

## Objectif

Rebrand complet du projet de **Pyxalix** vers **Pyx** pour :
- Simplifier le nom commercial (éviter redondance "Pyxalix.Devamalix.fr")
- Moderniser l'identité de marque
- Améliorer la mémorabilité

**Nomenclature finale :**
- **Nom commercial :** Pyx
- **Nom technique :** DM (Digital Marketplace) - inchangé
- **Domaine production :** `pyx.devamalix.fr`
- **Domaine Nexus :** `pyx.nexus.local`
- **Repository :** `dm` (inchangé)

## Livrables

- [x] Mise à jour configuration Docker (3 fichiers docker-compose)
- [x] Mise à jour documentation complète (17 fichiers)
- [x] Mise à jour templates HTML (5 fichiers)
- [x] Documentation technique du rebrand
- [x] Guide opérationnel de déploiement
- [x] Points d'attention et troubleshooting
- [x] Guide renommage repository GitHub (optionnel)
- [x] Message de commit structuré
- [x] Documentation de l'étape (ce fichier)

## Changements Effectués

### 1. Configuration Docker

#### docker-compose.yml (Production VPS)
- Network name : `pyxalix-network` → `pyx-network`
- Container names : `pyxalix_web` → `pyx_web`, `pyxalix_postgres` → `pyx_postgres`
- Traefik Host : `pyxalix.devamalix.fr` → `pyx.devamalix.fr`
- Traefik router/service : `pyxalix-web` → `pyx-web`
- Header commentaire : "Pyx (DM) - Production avec Traefik"

#### docker-compose.nexus.yml (Serveur Nexus)
- Traefik Host : `dm.nexus.local` → `pyx.nexus.local`
- Traefik router/service : `dm-web-nexus` → `pyx-web-nexus`
- Header commentaire : "Pyx (DM) - Configuration NEXUS"

#### docker-compose.dev.yml (Développement)
- Header commentaire : "Pyx (DM) - Environnement de développement"

### 2. Documentation (17 fichiers)

**Fichiers principaux modifiés :**
- `README.md` : Header + nomenclature explicite (commercial vs technique)
- `docs/INFRASTRUCTURE.md` : Variables d'env (ALLOWED_HOSTS, CSRF_TRUSTED_ORIGINS)
- `docs/DOCKER-COMPOSE-CONFIGS.md` : Tableaux comparatifs Nexus vs VPS
- `docs/versions/s1_versions.md` : Noms containers et domaines
- `docs/progress/s1_e4.md` : Références domaines
- `docs/checklists/deploy-vps-v0.2.0.md` : Domaines et containers

**Remplacements globaux effectués :**
- `pyxalix.devamalix.fr` → `pyx.devamalix.fr` (tous les fichiers)
- `dm.nexus.local` → `pyx.nexus.local` (tous les fichiers)
- `pyxalix-web` → `pyx-web` (routers/services Traefik)
- `pyxalix_web` → `pyx_web` (noms containers)
- `pyxalix_postgres` → `pyx_postgres` (noms containers)
- `pyxalix-network` → `pyx-network` (networks Docker)

### 3. Templates HTML (5 fichiers)

**Tous les templates dans `core/templates/` :**
- `base.html` : Titre, logo navigation, footer
- `home.html` : Titre page, heading principal
- `catalog.html` : Titre page
- `product.html` : Pattern titre avec nom produit
- `thanks.html` : Titre confirmation

**Remplacement :** `Pyxalix` → `Pyx` (tous les affichages utilisateur)

### 4. Documentation Rebrand Créée

Aucune documentation de rebrand créée dans `docs/` car guides destinés à usage personnel (hors versioning).

## Architecture Finale

### Domaines et Routage

**Production VPS :**
```
Internet HTTPS
    ↓
Traefik v3 (Let's Encrypt)
    ↓
    ├─ pyx.devamalix.fr → Django (pyx_web) [priority 1]
    │    ↓
    │  PostgreSQL (pyx_postgres)
    │
    └─ pyx.devamalix.fr/media/ → nginx-static [priority 100]
```

**Nexus (local) :**
```
pyx.nexus.local (HTTP)
    ↓
Traefik (pas HTTPS)
    ↓
    ├─ pyx.nexus.local → Django (dm_web) [priority 1]
    │    ↓
    │  PostgreSQL (dm_postgres)
    │
    └─ pyx.nexus.local/media/ → nginx-static [priority 100]
```

### Networks Docker

- **Production :** `pyx-network` (interne), `traefik-network` (externe)
- **Nexus :** `nexus-dm` (interne), `traefik-network` (externe)
- **Dev :** `dm-dev-network` (interne uniquement)

## Actions Requises pour Déploiement

**⚠️ BREAKING CHANGES :** Le déploiement nécessite actions manuelles

### A. Configuration DNS (OVH)

1. Ajouter enregistrement A :
   ```
   Sous-domaine : pyx
   Type : A
   Cible : 37.59.115.242
   TTL : 300 (5 minutes)
   ```

2. Attendre propagation DNS (5-15 min, jusqu'à 48h)
   ```bash
   nslookup pyx.devamalix.fr
   # Doit retourner : 37.59.115.242
   ```

### B. Déploiement VPS

1. **Backup obligatoire :**
   ```bash
   ssh ubuntu@37.59.115.242
   cd ~/dm
   cp docker-compose.yml docker-compose.yml.backup.$(date +%Y%m%d)
   docker compose exec db pg_dump -U dm_user dm_db > ~/backups/dm_pre_rebrand.sql
   ```

2. **Pull modifications :**
   ```bash
   git pull origin main
   ```

3. **Modifier .env manuellement (CRITIQUE) :**
   ```bash
   nano .env
   # Modifier :
   DJANGO_ALLOWED_HOSTS=127.0.0.1,localhost,pyx.devamalix.fr
   DJANGO_CSRF_TRUSTED_ORIGINS=https://pyx.devamalix.fr
   ```

4. **Redémarrer services (downtime 2-5 min) :**
   ```bash
   docker compose down
   docker compose up -d
   ```

5. **Attendre génération certificat HTTPS (30s) :**
   ```bash
   sleep 30
   curl -I https://pyx.devamalix.fr
   # Doit retourner : 200 OK
   ```

### C. Validation Post-Déploiement

**Tests obligatoires :**
- [ ] `docker compose ps` → containers `pyx_web` et `pyx_postgres` UP
- [ ] `https://pyx.devamalix.fr` → page d'accueil accessible
- [ ] Certificat HTTPS Let's Encrypt valide (cadenas vert)
- [ ] Titre affiche "Pyx" (pas "Pyxalix")
- [ ] Logo navigation affiche "Pyx"
- [ ] Footer affiche "© 2025 Pyx"
- [ ] Catalogue accessible et images chargent (nginx-static)
- [ ] Logs propres (pas d'erreurs ALLOWED_HOSTS ou CSRF)

### D. Ancien Domaine

**pyxalix.devamalix.fr :**
- Continuera à pointer vers VPS mais Traefik ne route plus
- Comportement attendu : 404 de Traefik
- Action : Garder 1-2 semaines puis supprimer enregistrement DNS OVH

## Points d'Attention Critiques

1. **DNS propagation :** NE PAS déployer VPS avant propagation complète
2. **Fichier .env :** DOIT être modifié manuellement sur VPS (pas dans Git)
3. **Backup BDD :** Obligatoire avant toute modification
4. **Certificat HTTPS :** Attendre 30s après `docker compose up -d`
5. **Downtime :** 2-5 minutes pendant redémarrage containers
6. **Validation complète :** Tester TOUS les endpoints avant de considérer terminé

## Repository GitHub (Optionnel)

**Renommage `dm` → `pyx` NON effectué.**

**Raisons de ne pas renommer (recommandé) :**
- Cohérence avec structure de dossiers (`~/dm`, `~/nexus/dev-web/dm`)
- Nom technique "dm" court et clair
- Évite mise à jour de tous les clones locaux (Nexus, VPS, PC)
- Évite reconfiguration webhooks et intégrations
- Nom commercial "Pyx" déjà visible dans README et templates

**Si renommage souhaité plus tard :**
- Nécessite mise à jour remote URL sur tous les clones
- Nécessite mise à jour liens externes (portfolio, CV, LinkedIn)
- Temps estimé : 25-40 minutes
- Voir documentation guides personnels pour procédure détaillée

## Métriques

- **Fichiers modifiés :** ~20 fichiers
- **Lignes changées :** ~100 lignes
- **Types de fichiers :**
  - 3 docker-compose (yml)
  - 17 fichiers Markdown (docs)
  - 5 templates HTML
  - 1 README
- **Temps réel :** ~1h30 (modifications code + documentation sprint)
- **Downtime VPS :** 2-5 minutes (redémarrage containers)
- **Temps déploiement estimé :** 30-45 minutes (DNS + VPS + validation)

## Rollback

En cas de problème critique sur VPS :

```bash
# Restaurer backup configuration
cd ~/dm
cp docker-compose.yml.backup.YYYYMMDD docker-compose.yml

# Restaurer .env
nano .env
# Remettre : pyxalix.devamalix.fr

# Redémarrer
docker compose down
docker compose up -d

# Sur OVH : re-créer enregistrement pyxalix.devamalix.fr
```

## Notes Techniques

- **Nom repository :** Reste `dm` (pas de renommage GitHub)
- **Code Python :** Aucun changement (modules/packages inchangés)
- **Base de données :** Schéma et tables inchangés
- **Variables .env :** Clés identiques (seules valeurs domaines changent)
- **Structure système :** Chemins `~/dm` et `~/nexus/dev-web/dm` inchangés

## Statut

✅ **Modifications terminées dans Nexus**
⏳ **En attente de déploiement VPS par utilisateur**

Actions utilisateur requises :
1. Configuration DNS OVH
2. Git commit + push
3. Déploiement VPS avec guide opérationnel
4. Validation complète

---

**Date :** 30 octobre 2025
**Durée :** 1h30
**Tag prévu :** v0.2.1
